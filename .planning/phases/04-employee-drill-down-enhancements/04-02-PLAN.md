---
phase: 04-employee-drill-down-enhancements
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/src/components/reports/ByEmployeeTab.tsx
autonomous: true
requirements: [EDR-02, EDR-03]

must_haves:
  truths:
    - "Employee drill-down entry table shows ALL entries for the selected date range (no .slice(0, 10) limit)"
    - "Entry table paginates at 50 entries per page with Page X of Y navigation"
    - "Entry table has a Topic column showing topicName for each entry"
    - "Entry table defaults to date descending sort"
    - "Entry table columns are: Date, Client, Topic, Description, Hours"
  artifacts:
    - path: "app/src/components/reports/ByEmployeeTab.tsx"
      provides: "DataTable-based entry table with Topic column and pagination"
      contains: "DataTable"
  key_links:
    - from: "app/src/components/reports/ByEmployeeTab.tsx"
      to: "app/src/components/ui/DataTable.tsx"
      via: "import { DataTable }"
      pattern: "DataTable.*data.*employeeEntries"
    - from: "app/src/components/reports/ByEmployeeTab.tsx"
      to: "app/src/components/ui/table-types.ts"
      via: "import { ColumnDef }"
      pattern: "ColumnDef.*Entry"
---

<objective>
Replace the hand-rolled 10-entry table in the employee drill-down with a DataTable component featuring Topic column, pagination, and sortable headers.

Purpose: Admins can browse all entries for an employee with topic context and pagination (EDR-02, EDR-03).
Output: Updated `ByEmployeeTab.tsx` with DataTable replacing the hand-rolled table section.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-employee-drill-down-enhancements/04-RESEARCH.md
@.planning/phases/04-employee-drill-down-enhancements/04-01-SUMMARY.md

# Reference implementation — how ByClientTab does the same thing
@app/src/components/reports/ByClientTab.tsx
# Component to modify (after 04-01 changes)
@app/src/components/reports/ByEmployeeTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace hand-rolled entry table with DataTable</name>
  <files>app/src/components/reports/ByEmployeeTab.tsx</files>
  <action>
Modify ByEmployeeTab.tsx to replace the hand-rolled entry table with DataTable. This mirrors ByClientTab's entry table implementation from Phase 3 plan 02.

**1. Add imports at top of file:**
```typescript
import { DataTable } from "@/components/ui/DataTable";
import { ColumnDef } from "@/components/ui/table-types";
```

**2. Remove the `.slice(0, 10)` code:**
Delete the `recentEntries` computation (current lines ~127-129):
```typescript
// DELETE THIS:
const recentEntries = [...employeeEntries]
  .sort((a, b) => b.date.localeCompare(a.date))
  .slice(0, 10);
```

**3. Add column definitions (inside the drill-down block, after chart data prep):**
Column order: Date, Client, Topic, Description, Hours. Note: Client column (not Employee) because we already know which employee — the pivot dimension is the client.

```typescript
const entryColumns: ColumnDef<Entry>[] = [
  {
    id: "date",
    header: "Date",
    accessor: (row) => row.date,
    cell: (row) => (
      <span className="text-[var(--text-secondary)] text-[13px]">
        {formatDateDisplay(row.date)}
      </span>
    ),
  },
  {
    id: "client",
    header: "Client",
    accessor: (row) => row.client.name,
    cell: (row) => (
      <span className="text-[var(--text-primary)] text-[13px]">
        {row.client.name}
      </span>
    ),
  },
  {
    id: "topic",
    header: "Topic",
    accessor: (row) => row.topicName,
    cell: (row) => (
      <span className="text-[var(--text-secondary)] text-[13px]">
        {row.topicName}
      </span>
    ),
  },
  {
    id: "description",
    header: "Description",
    accessor: (row) => row.description,
    cell: (row) => (
      <span className="text-[var(--text-secondary)] text-[13px] max-w-xs truncate block">
        {row.description}
      </span>
    ),
    sortable: false,
  },
  {
    id: "hours",
    header: "Hours",
    accessor: (row) => row.hours,
    align: "right",
    cell: (row) => (
      <span className="text-[var(--text-primary)] text-[13px]">
        {formatHours(row.hours)}
      </span>
    ),
  },
];
```

**4. Replace the entire hand-rolled table section** (the `<div className="bg-[var(--bg-elevated)]...">` containing `<table>`, `<thead>`, `<tbody>`, and the `recentEntries.map(...)`) with:

```tsx
{/* Entries table */}
<h3 className="text-[11px] uppercase tracking-wider text-[var(--text-muted)]">
  Entries
</h3>
<DataTable
  data={employeeEntries}
  columns={entryColumns}
  getRowKey={(entry) => entry.id}
  pageSize={50}
  defaultSort={{ columnId: "date", direction: "desc" }}
  emptyMessage="No entries for this employee"
/>
```

This replaces:
- The "Recent Entries" heading (change to "Entries" since it's no longer limited to recent)
- The entire `<div className="bg-[var(--bg-elevated)]...">` wrapping the hand-rolled table
- The `<table>`, `<thead>`, `<tbody>`, and all `<tr>`/`<td>` elements

**Critical checks:**
- Do NOT keep the old table alongside the DataTable. Fully replace it.
- Do NOT keep the `recentEntries` variable. Use `employeeEntries` directly.
- The "Entries" heading should be a standalone `<h3>` above the DataTable (same as ByClientTab pattern), since DataTable renders its own card container.
  </action>
  <verify>
    <automated>cd /Users/stefan/projects/veda-legal-timesheets/app && npm run test -- --run ByEmployeeTab 2>&1 | tail -20</automated>
    <manual>All 8 tests should pass GREEN. Entry table shows all entries with Topic column, pagination at 50/page, date-descending default sort.</manual>
    <sampling_rate>run after this task commits, then run full suite before phase completion</sampling_rate>
  </verify>
  <done>Hand-rolled table fully replaced with DataTable. All entries shown (no 10-entry limit). Topic column present. Pagination at 50 entries/page. Default sort date descending. All 8 ByEmployeeTab tests pass GREEN. EDR-02 and EDR-03 requirements satisfied.</done>
</task>

</tasks>

<verification>
- `npm run test -- --run ByEmployeeTab` — ALL 8 tests pass GREEN
- `npm run test -- --run` — Full test suite passes (no regressions)
- ByEmployeeTab.tsx contains `import { DataTable }` and `import { ColumnDef }`
- No `.slice(0, 10)` or `recentEntries` variable remains
- No hand-rolled `<table>`, `<thead>`, `<tbody>` elements remain in the drill-down section
- Columns are: Date, Client, Topic, Description, Hours (in that order)
- DataTable has `pageSize={50}` and `defaultSort={{ columnId: "date", direction: "desc" }}`
</verification>

<success_criteria>
- All entries visible for selected employee (not limited to 10)
- Pagination appears when >50 entries
- Topic column header and topicName values rendered in rows
- Date descending default sort
- Description column not sortable
- All other columns sortable
- EDR-02 and EDR-03 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/04-employee-drill-down-enhancements/04-02-SUMMARY.md`
</output>
