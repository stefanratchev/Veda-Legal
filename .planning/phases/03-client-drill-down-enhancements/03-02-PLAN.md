---
phase: 03-client-drill-down-enhancements
plan: 02
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified:
  - app/src/components/reports/ByClientTab.tsx
autonomous: true
requirements:
  - CDR-02
  - CDR-03
  - CDR-04

must_haves:
  truths:
    - "Client drill-down entry table shows ALL entries for the selected date range, not limited to 10"
    - "Entry table has pagination with 'Page X of Y' and prev/next buttons when entries exceed 50"
    - "Entry table includes a Topic column showing topicName for each entry"
    - "Entry table columns are in order: Date, Employee, Topic, Description, Hours"
    - "Entry table is sortable by clicking column headers"
    - "Default sort is newest first (date descending)"
  artifacts:
    - path: "app/src/components/reports/ByClientTab.tsx"
      provides: "DataTable-based entry table with topic column and pagination"
      contains: "DataTable"
  key_links:
    - from: "app/src/components/reports/ByClientTab.tsx"
      to: "app/src/components/ui/DataTable.tsx"
      via: "DataTable component with columns and pageSize props"
      pattern: "DataTable.*columns.*pageSize"
    - from: "app/src/components/reports/ByClientTab.tsx"
      to: "app/src/components/ui/table-types.ts"
      via: "ColumnDef type import for column definitions"
      pattern: "import.*ColumnDef.*table-types"
---

<objective>
Replace the hand-rolled 10-entry table with DataTable component, adding topic column, pagination, and sorting.

Purpose: Admins need to see ALL entries for a client in the selected period (CDR-03), with a topic column (CDR-04), sortable headers, and pagination. CDR-02 (hours-over-time trend chart) was DROPPED by user decision -- this plan notes it in requirements for traceability but implements nothing for it.
Output: Full entry table powered by DataTable with 50 entries per page, sortable columns, topic column, default date-descending sort.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-client-drill-down-enhancements/03-CONTEXT.md
@.planning/phases/03-client-drill-down-enhancements/03-RESEARCH.md
@.planning/phases/03-client-drill-down-enhancements/03-01-SUMMARY.md
@app/src/components/reports/ByClientTab.tsx
@app/src/components/ui/DataTable.tsx
@app/src/components/ui/table-types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace hand-rolled entry table with DataTable</name>
  <files>
    app/src/components/reports/ByClientTab.tsx
  </files>
  <action>
1. **Add imports** at the top of `ByClientTab.tsx`:
   ```typescript
   import { DataTable } from "@/components/ui/DataTable";
   import { ColumnDef } from "@/components/ui/table-types";
   ```

2. **Remove the `.slice(0, 10)` logic** — delete the `recentEntries` variable that sorts and slices to 10 entries. All entries will be passed to DataTable which handles sorting and pagination internally.

3. **Define column definitions** inside the drill-down block (after `topicChartData` / chart data preparation, before the return JSX). Use the Entry type already defined in the file:

   ```typescript
   const entryColumns: ColumnDef<Entry>[] = [
     {
       id: "date",
       header: "Date",
       accessor: (row) => row.date,
       cell: (row) => (
         <span className="text-[var(--text-secondary)] text-[13px]">
           {formatDateDisplay(row.date)}
         </span>
       ),
     },
     {
       id: "employee",
       header: "Employee",
       accessor: (row) => row.employee.name,
       cell: (row) => (
         <span className="text-[var(--text-primary)] text-[13px]">
           {row.employee.name}
         </span>
       ),
     },
     {
       id: "topic",
       header: "Topic",
       accessor: (row) => row.topicName,
       cell: (row) => (
         <span className="text-[var(--text-secondary)] text-[13px]">
           {row.topicName}
         </span>
       ),
     },
     {
       id: "description",
       header: "Description",
       accessor: (row) => row.description,
       cell: (row) => (
         <span className="text-[var(--text-secondary)] text-[13px] max-w-xs truncate block">
           {row.description}
         </span>
       ),
       sortable: false,
     },
     {
       id: "hours",
       header: "Hours",
       accessor: (row) => row.hours,
       align: "right",
       cell: (row) => (
         <span className="text-[var(--text-primary)] text-[13px]">
           {formatHours(row.hours)}
         </span>
       ),
     },
   ];
   ```

   Column order: Date, Employee, Topic, Description, Hours (per user decision).
   Description is `sortable: false` (sorting by description text is not meaningful).

4. **Replace the hand-rolled table JSX** (the entire `<div className="bg-[var(--bg-elevated)]...">` block containing the `<table>` with `recentEntries.map(...)`) with:

   ```tsx
   {/* Entries section heading */}
   <h3 className="text-[11px] uppercase tracking-wider text-[var(--text-muted)]">
     Entries
   </h3>
   <DataTable
     data={clientEntries}
     columns={entryColumns}
     getRowKey={(entry) => entry.id}
     pageSize={50}
     defaultSort={{ columnId: "date", direction: "desc" }}
     emptyMessage="No entries for this client"
   />
   ```

   Pass `clientEntries` (not `recentEntries`) — this is all entries for the client, already filtered from the full entries array. DataTable handles sorting and pagination internally. Page size 50 per user decision (~50 entries per page). Default sort by date descending (newest first).

5. **Section heading placement** — The "Entries" heading should be a standalone `<h3>` above the `<DataTable>` component, NOT inside a wrapping card div. The DataTable already renders its own `bg-[var(--bg-elevated)]` card container. Keep the `<h3>` and `<DataTable>` as adjacent children in the existing `space-y-6` container.
  </action>
  <verify>
    <automated>cd /Users/stefan/projects/veda-legal-timesheets/app && npx tsc --noEmit --pretty 2>&1 | head -50 && npm run test -- --run ByClientTab</automated>
    <manual>Run dev server, navigate to Reports > By Client > click a client with many entries. Verify: (1) All entries shown (not limited to 10), (2) Topic column present with topic names, (3) Pagination appears when entries > 50 with "Page 1 of N" and prev/next, (4) Click column headers to sort, (5) Default sort is newest date first, (6) Columns in order: Date, Employee, Topic, Description, Hours.</manual>
  </verify>
  <done>Entry table uses DataTable component with 50 entries per page, topic column, sortable headers, date-descending default sort. No 10-entry limit. Pagination appears when entries exceed 50.</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd app && npx tsc --noEmit` — no errors
2. Dev server runs: `npm run dev` — no console errors
3. Visual check: Reports > By Client > click client → entry table shows all entries with Topic column
4. Pagination: If client has >50 entries, pagination controls appear at bottom
5. Sorting: Click Date header → toggles sort direction. Click Employee → sorts alphabetically.
6. Default order: On first load, entries are date descending (newest first)
7. Column order: Date | Employee | Topic | Description | Hours
8. CDR-02 (hours trend chart): Intentionally NOT implemented (dropped by user decision)
</verification>

<success_criteria>
- Entry table shows ALL entries for selected date range (no 10-entry limit)
- Pagination with "Page X of Y" and prev/next buttons when entries exceed 50
- Topic column displays topicName for each entry
- Columns in order: Date, Employee, Topic, Description, Hours
- Sortable column headers (except Description)
- Default sort: date descending (newest first)
- CDR-02 noted as dropped, no implementation
</success_criteria>

<output>
After completion, create `.planning/phases/03-client-drill-down-enhancements/03-02-SUMMARY.md`
</output>
