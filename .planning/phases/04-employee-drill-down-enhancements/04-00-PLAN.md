---
phase: 04-employee-drill-down-enhancements
plan: 00
type: execute
wave: 0
depends_on: []
files_modified:
  - app/src/components/reports/ByEmployeeTab.test.tsx
autonomous: true
requirements: [EDR-01, EDR-02, EDR-03]

must_haves:
  truths:
    - "Failing tests exist for topic breakdown chart rendering (EDR-01)"
    - "Failing tests exist for full entry table with pagination (EDR-02)"
    - "Failing tests exist for topic column in entry table (EDR-03)"
  artifacts:
    - path: "app/src/components/reports/ByEmployeeTab.test.tsx"
      provides: "Test scaffold with failing stubs for all three requirements"
      contains: "describe"
  key_links:
    - from: "app/src/components/reports/ByEmployeeTab.test.tsx"
      to: "app/src/components/reports/ByEmployeeTab.tsx"
      via: "import { ByEmployeeTab }"
      pattern: "import.*ByEmployeeTab"
---

<objective>
Create a failing test scaffold for ByEmployeeTab covering all three phase requirements (EDR-01, EDR-02, EDR-03) before any implementation begins.

Purpose: Establish RED test stubs that validate the topic breakdown chart, full entry table with pagination, and topic column. These tests guide implementation in plans 04-01 and 04-02 and serve as the Nyquist sampling command.
Output: `app/src/components/reports/ByEmployeeTab.test.tsx` with ~8 test stubs (some passing vacuously, some failing RED).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-employee-drill-down-enhancements/04-RESEARCH.md

# Reference implementation — Phase 3 test scaffold
@app/src/components/reports/ByClientTab.test.tsx
# Current component under test
@app/src/components/reports/ByEmployeeTab.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ByEmployeeTab.test.tsx with failing test stubs</name>
  <files>app/src/components/reports/ByEmployeeTab.test.tsx</files>
  <action>
Create `app/src/components/reports/ByEmployeeTab.test.tsx` mirroring the Phase 3 `ByClientTab.test.tsx` pattern exactly. Structure:

**Mock setup:**
- Mock `./charts/BarChart` to render data as DOM text (`data-testid="bar-chart"` with `<span>` per item) — identical to ByClientTab.test.tsx mock.

**Interfaces (target post-implementation shape):**
- `EmployeeStats`: `{ id, name, totalHours, clientCount, topClient, clients, dailyHours, topics: { topicName: string; totalHours: number; writtenOffHours: number }[] }` — includes `topics` which does NOT exist on current ByEmployeeTab interface yet (will be added in 04-01).
- `Entry`: `{ id, date, hours, description, topicName: string, client: { id, name }, employee: { id, name } }` — includes `topicName` which does NOT exist on current ByEmployeeTab interface yet (will be added in 04-01).

**Factory functions:**
- `createEmployee(overrides?)` — returns `EmployeeStats` with defaults: `{ id: "e1", name: "John Smith", totalHours: 24, clientCount: 2, topClient: { name: "Acme Corp", hours: 16 }, clients: [{ id: "c1", name: "Acme Corp", hours: 16 }, { id: "c2", name: "Beta Ltd", hours: 8 }], dailyHours: [{ date: "2026-02-20", hours: 8 }], topics: [{ topicName: "M&A Advisory", totalHours: 14, writtenOffHours: 0 }, { topicName: "Company Law", totalHours: 10, writtenOffHours: 0 }] }`
- `createEntry(overrides?)` — returns `Entry` with defaults: `{ id: "entry-1", date: "2026-02-20", hours: 2, description: "Drafted agreement", topicName: "M&A Advisory", client: { id: "c1", name: "Acme Corp" }, employee: { id: "e1", name: "John Smith" } }`

**Default props:**
```typescript
const defaultProps = {
  isAdmin: true,
  currentUserId: "e1",
  onSelectEmployee: vi.fn(),
  selectedEmployeeId: "e1",
};
```

**Test stubs (8 total, 4 describe blocks):**

1. **describe("topic breakdown chart")** — EDR-01
   - `it("renders Topic Breakdown heading when employee with topics is selected")` — Render with employee selected, assert `screen.getByText("Topic Breakdown")` exists.
   - `it("hides zero-hour topics from chart data")` — Create employee with one zero-hour topic and one active topic. Assert `container.textContent` does NOT contain the zero-hour topic name.
   - `it("shows hours and percentage in topic bar labels")` — Create employee with `topics: [{ topicName: "M&A Advisory", totalHours: 14, writtenOffHours: 0 }]` and `totalHours: 24`. Assert container text includes "14h" or "58%" pattern.

2. **describe("entry table")** — EDR-02
   - `it("renders all entries via DataTable, not limited to 10")` — Create 15 entries with dates 2026-02-01 through 2026-02-15. Assert `screen.getByText("Entry description 0")` (the oldest, which would be excluded by `.slice(0, 10)` after date-desc sort).
   - `it("shows pagination when entries exceed page size")` — Create 60 entries. Assert `screen.getByText(/Page 1 of/)` exists.

3. **describe("entry table columns")** — EDR-03
   - `it("renders Topic column header")` — Assert `screen.getAllByText("Topic")` has at least 1 match.
   - `it("shows topicName in entry rows")` — Assert `screen.getAllByText("M&A Advisory")` has at least 1 match.

4. **describe("default sort")** — EDR-02
   - `it("sorts entries by date descending by default")` — Create 3 entries with different dates. Assert `container.querySelectorAll("tbody tr")[0].textContent` contains the newest date.

**Important:** All entries in tests must have `client` property with `{ id, name }` — this is the employee drill-down context. Tests should NOT have an `employee` column expectation (we already know which employee — the pivot dimension is Client).
  </action>
  <verify>
    <automated>cd /Users/stefan/projects/veda-legal-timesheets/app && npm run test -- --run ByEmployeeTab 2>&1 | tail -20</automated>
    <manual>Some tests should FAIL (RED) because ByEmployeeTab doesn't have topics, topicName, Topic Breakdown chart, or DataTable yet. Some may pass vacuously.</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>ByEmployeeTab.test.tsx exists with 8 test stubs across 4 describe blocks. Test runner executes without import/syntax errors. At least 3 tests are in RED state (failing) for features not yet implemented.</done>
</task>

</tasks>

<verification>
- `app/src/components/reports/ByEmployeeTab.test.tsx` exists and is syntactically valid
- `npm run test -- --run ByEmployeeTab` runs without import errors
- Failing tests (RED) exist for: Topic Breakdown heading, topic labels, DataTable pagination, Topic column header, topicName in rows
- Passing tests (vacuous GREEN) may exist for: zero-hour topic filtering, all entries shown, date sort
</verification>

<success_criteria>
- Test file created with factory functions, mock setup, and 8 test stubs
- Tests execute in < 5 seconds
- At least 3 tests fail (RED) for unimplemented features
- Nyquist sampling command established: `npm run test -- --run ByEmployeeTab`
</success_criteria>

<output>
After completion, create `.planning/phases/04-employee-drill-down-enhancements/04-00-SUMMARY.md`
</output>
