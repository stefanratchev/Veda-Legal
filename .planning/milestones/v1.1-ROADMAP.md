# Roadmap: Veda Legal Timesheets

## Milestones

- ✅ **v1.0 Reports Improvements** — Phases 1-4 (shipped 2026-02-24)
- **v1.1 E2E Timesheets** — Phases 5-7 (in progress)

## Phases

<details>
<summary>✅ v1.0 Reports Improvements (Phases 1-4) — SHIPPED 2026-02-24</summary>

- [x] Phase 1: Data Layer (2/2 plans) — completed 2026-02-24
- [x] Phase 2: Overview Revenue Charts (2/2 plans) — completed 2026-02-24
- [x] Phase 3: Client Drill-Down Enhancements (3/3 plans) — completed 2026-02-24
- [x] Phase 4: Employee Drill-Down Enhancements (3/3 plans) — completed 2026-02-24

See: [milestones/v1.0-ROADMAP.md](./milestones/v1.0-ROADMAP.md)

</details>

### v1.1 E2E Timesheets

**Milestone Goal:** Browser-level regression protection for the revenue-critical timesheet workflow, so new feature development can't silently break daily time entry.

- [x] **Phase 5: Test Infrastructure** - Auth bypass, test database, fixtures, data-testid attributes, and smoke test
- [x] **Phase 6: Core Timesheet Workflow Tests** - Page Object Model, API factory, and ~15 e2e tests across 3 spec files (completed 2026-02-25)
- [x] **Phase 7: CI Integration** - GitHub Actions e2e job with PostgreSQL service container and Chromium caching (completed 2026-02-25)

## Phase Details

### Phase 5: Test Infrastructure
**Goal**: A developer can run `npm run test:e2e` and a single smoke test passes — proving auth bypass, test database, seed data, and Playwright config all work end-to-end
**Depends on**: Nothing (first phase of v1.1; v1.0 phases 1-4 are shipped)
**Requirements**: REQ-01, REQ-02, REQ-03, REQ-04, REQ-05, REQ-06, REQ-07, REQ-08, REQ-09, REQ-10
**Success Criteria** (what must be TRUE):
  1. Running `npm run test:e2e` from the `app/` directory launches Playwright, starts the dev server against `veda_legal_test`, and executes at least one test
  2. The smoke test navigates to `/timesheets` and sees the timesheets page (not a redirect to `/login`) — proving JWT cookie auth bypass works
  3. The timesheets page renders ClientSelect, TopicCascadeSelect, and DurationPicker with seed data (2 clients, 2 topics, 3 subtopics visible in dropdowns) — proving test database seeding works
  4. Running the smoke test twice in sequence produces the same result — proving `TRUNCATE CASCADE` cleanup prevents state leakage
  5. Key UI components have `data-testid` attributes (ClientSelect, TopicCascadeSelect, DurationPicker, EntryCard, WeekStrip, submit button) usable as Playwright locators
**Plans:** 2/2 plans complete
Plans:
- [x] 05-01-PLAN.md — Playwright setup, config, auth bypass, seed data, DB fixtures, composed test export
- [x] 05-02-PLAN.md — data-testid attributes on 6 components + smoke test

### Phase 6: Core Timesheet Workflow Tests
**Goal**: The full timesheet user journey — create, edit, delete entries, navigate dates, and submit a day — is covered by e2e tests that pass locally
**Depends on**: Phase 5
**Requirements**: REQ-11, REQ-12, REQ-13, REQ-14, REQ-15, REQ-16, REQ-17, REQ-18, REQ-19, REQ-20, REQ-21, REQ-22, REQ-23, REQ-24
**Success Criteria** (what must be TRUE):
  1. A user can create a time entry for a REGULAR client (with subtopic prefix behavior) and see it appear in the entry list — tested end-to-end through the browser
  2. A user can create a time entry for an INTERNAL client (topic-only, no subtopic) and see it appear — tested end-to-end
  3. A user can edit an existing entry's description and hours, and can cancel an edit without saving — tested end-to-end
  4. A user can delete an entry (with confirmation) and verify it disappears, and can cancel deletion to preserve it — tested end-to-end
  5. A user can navigate dates via WeekStrip (select day, prev/next week, Today button) and entries persist correctly per day — tested end-to-end
  6. A user can log 8+ hours and submit the day, seeing the submission status indicator update — tested end-to-end
**Plans:** 3/3 plans complete
Plans:
- [x] 06-01-PLAN.md — Page Object Model + API data factory (foundation)
- [x] 06-02-PLAN.md — Entry CRUD spec (~6 tests: create, edit, delete)
- [x] 06-03-PLAN.md — Navigation + submission specs (~6 tests: WeekStrip nav, daily submission)

### Phase 7: CI Integration
**Goal**: Every PR to `main` automatically runs the e2e test suite against a production build, so regressions are caught before merge
**Depends on**: Phase 6
**Requirements**: REQ-25, REQ-26, REQ-27, REQ-28, REQ-29, REQ-30
**Success Criteria** (what must be TRUE):
  1. A new `e2e` job appears in the CI workflow and runs on every PR to `main`
  2. The e2e job provisions its own PostgreSQL 17 database, runs migrations, and executes Playwright tests against a production build (`next build && next start`)
  3. When e2e tests fail, the HTML report is uploaded as a downloadable artifact for debugging
  4. The existing unit test job continues to run independently and is unaffected by the new e2e job
**Plans:** 1/1 plans complete
Plans:
- [x] 07-01-PLAN.md — E2e CI job with PostgreSQL service, Chromium caching, production build, artifact upload

## Progress

**Execution Order:**
Phases execute in numeric order: 5 -> 6 -> 7
Each phase strictly depends on the previous (auth before tests, tests before CI).

| Phase | Milestone | Plans Complete | Status | Completed |
|-------|-----------|----------------|--------|-----------|
| 1. Data Layer | v1.0 | 2/2 | Complete | 2026-02-24 |
| 2. Overview Revenue Charts | v1.0 | 2/2 | Complete | 2026-02-24 |
| 3. Client Drill-Down Enhancements | v1.0 | 3/3 | Complete | 2026-02-24 |
| 4. Employee Drill-Down Enhancements | v1.0 | 3/3 | Complete | 2026-02-24 |
| 5. Test Infrastructure | v1.1 | Complete    | 2026-02-25 | 2026-02-25 |
| 6. Core Timesheet Workflow Tests | v1.1 | Complete    | 2026-02-25 | - |
| 7. CI Integration | v1.1 | Complete    | 2026-02-25 | - |
